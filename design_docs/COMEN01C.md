# 詳細設計書: COMEN01C (Main Menu)

## 1. 処理概要
一般ユーザー向けのメインメニュー画面。通信領域（DFHCOMMAREA）から引き継いだユーザー情報に基づき、利用可能な機能リストを表示する。ユーザーが選択した番号に応じて、対応する業務プログラムへ遷移する。

## 2. 入出力定義
- **画面 (BMS):** `COMEN01` (Mapset), `COMEN1A` (Map)
- **通信領域 (DFHCOMMAREA):** `CARDDEMO-COMMAREA` (COCOM01Y)
- **定数定義:** `COMEN02Y` (メニューオプションのプログラム名、名称、権限設定)

## 3. 処理フロー
1. **初期処理:**
    - `EIBCALEN = 0` (直接起動) の場合は、サインオン画面 (`COSGN00C`) へ戻る。
    - 初回入場時 (`CDEMO-PGM-REENTER = FALSE`) は、画面を初期化しメニューを表示。
2. **メニュー表示 (`SEND-MENU-SCREEN`):**
    - ヘッダー情報をセット。
    - `COMEN02Y` に定義されたオプションをループで処理し、画面に表示。
3. **キー入力判定:**
    - `ENTER` キー: 選択された項目のバリデーションと遷移処理を実行。
    - `PF3` キー: サインオン画面へ戻る。
4. **遷移処理 (`PROCESS-ENTER-KEY`):**
    - 入力されたオプション番号を取得。
    - 有効範囲チェック (1 ～ `CDEMO-MENU-OPT-COUNT`)。
    - 権限チェック: 一般ユーザーが管理者専用項目 ('A') を選択した場合はエラー。
    - プログラムの存在確認 (`EXEC CICS INQUIRE PROGRAM`)。
    - `XCTL` による遷移: 選択されたプログラムへ通信領域を渡して実行を移す。

## 4. データベース操作
- なし (メニュー表示用定数 `COMEN02Y` を参照)。

## 5. 例外処理
- 無効なオプション番号: `Please enter a valid option number...` を表示。
- 権限不足: `No access - Admin Only option...` を表示。
- 未インストール機能: `This option ... is not installed...` を表示。

## 6. 移行への考慮事項
- **動的メニュー:** メインフレームではコピーブック (`COMEN02Y`) でメニューをハードコードしているが、移行後はデータベースや設定ファイルから動的にメニューを構成することを検討。
- **プログラム遷移:** `XCTL` による遷移は、モダンな Web アプリケーションにおけるコンポーネントの切り替えや URL ルーティングに相当。
