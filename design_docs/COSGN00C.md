# 詳細設計書: COSGN00C (Signon Screen)

## 1. 処理概要
CardDemo アプリケーションのサインオン（ログイン）画面を制御するプログラム。ユーザーIDとパスワードの入力を受け付け、セキュリティファイル（USRSEC）と照合して認証を行う。認証成功後、ユーザー権限に応じて「メインメニュー」または「管理メニュー」へ遷移する。

## 2. 入出力定義
- **画面 (BMS):** `COSGN00` (Mapset), `COSGN0A` (Map)
- **ファイル (VSAM):** `USRSEC` (ユーザーセキュリティマスター、KSDS)
- **通信領域 (DFHCOMMAREA):** `CARDDEMO-COMMAREA` (COCOM01Y)

## 3. 処理フロー
1. **初期表示 (First Entry):**
    - `EIBCALEN = 0` の場合、画面をクリアし初期表示を行う。
    - カーソルをユーザーID項目にセットする。
2. **キー入力判定:**
    - `ENTER` キー: サインオン処理 (`PROCESS-ENTER-KEY`) を実行。
    - `PF3` キー: 終了メッセージを表示して終了。
    - その他: エラーメッセージを表示。
3. **サインオン処理:**
    - `RECEIVE MAP` で入力を取得。
    - ユーザーID、パスワードの未入力チェック。
    - 全項目を大文字に変換。
    - `USRSEC` ファイルをユーザーIDをキーに読み込む (`READ-USER-SEC-FILE`)。
4. **認証と遷移:**
    - ユーザーが見つからない、またはパスワード不一致の場合、エラーを表示。
    - 認証成功時:
        - 通信領域 (`CARDDEMO-COMMAREA`) にユーザーID、権限、遷移元プログラム情報をセット。
        - 管理者権限 ('A') の場合: `COADM01C` へ `XCTL` 遷移。
        - 一般ユーザー権限 ('U') の場合: `COMEN01C` へ `XCTL` 遷移。

## 4. データベース操作
- **VSAM (USRSEC) 読み込み:**
    - オペレーション: `EXEC CICS READ`
    - キー: `RIDFLD(WS-USER-ID)`
    - 判定: `WS-RESP-CD = 0` (成功), `13` (NOTFND)

## 5. 例外処理
- 入力エラー: 画面上の `ERRMSG` 領域にメッセージを表示。
- ファイルエラー: `Unable to verify the User ...` メッセージを表示。

## 6. 移行への考慮事項
- **パスワード管理:** 現行は VSAM に平文（または簡易変換）で保存されている可能性がある。移行後は Cloud SQL 上でハッシュ化して保存することを検討。
- **XCTL 遷移:** 画面遷移ロジックは、Node.js/React 等のフロントエンドルーティングへ置き換える必要がある。
